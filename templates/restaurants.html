{% extends "base.html" %}
{% block title %}Restaurants{% endblock %}

{% block content %}

<!-- ===================== -->
<!-- Page Header -->
<!-- ===================== -->
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2 class="fw-bold mb-0">ğŸ´ Restaurants</h2>

  {% if session.get("user_id") %}
    <a href="/add-restaurant" class="btn btn-primary">
      â• Add Restaurant
    </a>
  {% endif %}
</div>

<!-- ===================== -->
<!-- Search Bar -->
<!-- ===================== -->
<form method="get" class="mb-4">
  <div class="input-group input-group-lg shadow-sm">
    <span class="input-group-text bg-white">ğŸ”</span>
    <input
      type="text"
      name="q"
      class="form-control"
      placeholder="Search restaurant by name..."
      value="{{ request.args.get('q','') }}"
    >
    <button class="btn btn-dark">Search</button>
  </div>
</form>

<!-- ===================== -->
<!-- Restaurant List -->
<!-- ===================== -->
{% if restaurants %}
<div class="row g-4">

  {% for r in restaurants %}
  <div class="col-lg-4 col-md-6">
    <div class="card h-100 border-0 shadow-sm restaurant-card">

      <div class="card-body">
        <h5 class="card-title fw-semibold mb-1">
          <a href="/restaurants/{{ r.id }}"
             class="text-decoration-none text-dark">
            {{ r.name }}
          </a>
        </h5>

        <p class="text-muted small mb-3">
          ğŸ“ {{ r.location or "Unknown location" }}
        </p>

        {% if r.avg_rating() %}
          <span class="badge bg-success fs-6">
            â­ {{ r.avg_rating() }}
          </span>
        {% else %}
          <span class="badge bg-secondary fs-6">
            No ratings yet
          </span>
        {% endif %}
      </div>

      <!-- ===================== -->
      <!-- Owner Actions -->
      <!-- ===================== -->
      {% if session.get("user_id") %}
        {% set can_delete = false %}
        {% for review in r.reviews %}
          {% if review.user_id == session.get("user_id") %}
            {% set can_delete = true %}
          {% endif %}
        {% endfor %}

        {% if can_delete %}
        <div class="card-footer bg-white border-0 text-end">
          <a href="/restaurants/{{ r.id }}"
             class="btn btn-sm btn-outline-primary">
            View
          </a>

          <form method="post"
                action="/restaurants/{{ r.id }}/delete"
                class="d-inline"
                onsubmit="return confirm('Are you sure you want to delete this restaurant?')">
            <button class="btn btn-sm btn-outline-danger">
              Delete
            </button>
          </form>
        </div>
        {% endif %}
      {% endif %}

    </div>
  </div>
  {% endfor %}

</div>
{% else %}
<div class="text-center text-muted mt-5">
  <h5>No restaurants found ğŸ½ï¸</h5>
  <p>Try searching with another keyword</p>
</div>
{% endif %}

{% endblock %}
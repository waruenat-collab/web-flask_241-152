{% extends "base.html" %}
{% block content %}

<h2 class="mb-4">üç¥ Restaurants</h2>

<!-- üîç Search -->
<form method="get" class="mb-4">
    <div class="input-group">
        <input
            type="text"
            name="q"
            class="form-control"
            placeholder="Search restaurant..."
            value="{{ request.args.get('q','') }}"
        >
        <button class="btn btn-outline-secondary">Search</button>
    </div>
</form>

{% if restaurants %}
<div class="row">
{% for r in restaurants %}
    <div class="col-md-4 mb-4">
        <div class="card h-100 shadow-sm">
            <div class="card-body">
                <h5 class="card-title">
                    <a href="/restaurants/{{ r.id }}" class="text-decoration-none">
                        {{ r.name }}
                    </a>
                </h5>

                <p class="card-text text-muted">
                    {{ r.location }}
                </p>

                {% if r.avg_rating() %}
                    <span class="badge bg-success">
                        ‚≠ê {{ r.avg_rating() }}
                    </span>
                {% else %}
                    <span class="badge bg-secondary">
                        No ratings
                    </span>
                {% endif %}
            </div>

            {% if session.get("user_id") %}
            {% set can_delete = false %}
            {% for review in r.reviews %}
                {% if review.user_id == session.get("user_id") %}
                    {% set can_delete = true %}
                {% endif %}
            {% endfor %}

            {% if can_delete %}
            <div class="card-footer bg-white text-end">
                <a href="/restaurants/{{ r.id }}/edit"
                   class="btn btn-sm btn-warning">
                    Edit
                </a>

                <form method="post"
                      action="/restaurants/{{ r.id }}/delete"
                      class="d-inline"
                      onsubmit="return confirm('Delete this restaurant?')">
                    <button class="btn btn-sm btn-danger">
                        Delete
                    </button>
                </form>
            </div>
            {% endif %}
            {% endif %}
        </div>
    </div>
{% endfor %}
</div>
{% else %}
<p class="text-muted">No restaurants found.</p>
{% endif %}

{% endblock %}